{% load custom_filters %}
<form method="post"
    action="{% if form.instance.pk %}{% url 'catalogue:article_edit' form.instance.pk %}{% else %}{% url 'catalogue:article_create' %}{% endif %}"
    class="h-100 d-flex flex-column" novalidate>
    {% csrf_token %}
    <!-- SCROLLABLE CONTENT -->
    <div class="flex-grow-1 overflow-y-auto px-3 py-3">
        <!-- HEADER (If new or edit) -->
        <h5 class="fw-bold mb-3 text-dark">
            {% if form.instance.pk %}
            <i class="bi bi-pencil-square me-2 text-primary"></i>Modifier {{ form.instance.designation }}
            {% else %}
            <i class="bi bi-plus-circle me-2 text-success"></i>Nouvel Article
            {% endif %}
        </h5>
        <!-- SECTION 1: IDENTIFICATION -->
        <div class="mb-4">
            <h6 class="text-uppercase text-muted fw-bold small mb-2 border-bottom pb-2">
                <i class="bi bi-tag-fill me-2"></i>Identification
            </h6>
            <div class="row g-3">
                <div class="col-md-12">
                    <label class="form-label small fw-bold text-secondary text-uppercase">Désignation</label>
                    {{ form.designation|add_class:"form-control bg-body-tertiary border-0" }}
                    <div class="form-text text-muted small">Nom commercial complet de l'article.</div>
                </div>
                <div class="col-md-6">
                    <label class="form-label small fw-bold text-secondary text-uppercase">Code Article</label>
                    {{ form.code_article|add_class:"form-control bg-body-tertiary border-0 font-monospace" }}
                </div>
                <div class="col-md-6">
                    <label class="form-label small fw-bold text-secondary text-uppercase">Référence Usine</label>
                    {{ form.ref_fournisseur|add_class:"form-control bg-body-tertiary border-0" }}
                </div>
            </div>
        </div>
        <!-- SECTION 2: DONNÉES FINANCIÈRES & LOGISTIQUE -->
        <div class="mb-5">
            <h6 class="text-uppercase text-muted fw-bold small mb-3 border-bottom pb-2">
                <i class="bi bi-currency-euro me-2"></i>Données Commerciales
            </h6>
            <div class="row g-3">
                <div class="col-md-6">
                    <label class="form-label small fw-bold text-secondary text-uppercase">Prix Achat HT</label>
                    <div class="input-group">
                        {{ form.prix_achat|add_class:"form-control bg-body-tertiary border-0 text-end fw-bold" }}
                        <span class="input-group-text bg-body-tertiary border-0 text-muted">€</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label small fw-bold text-secondary text-uppercase">Unité</label>
                    {{ form.unite|add_class:"form-select bg-body-tertiary border-0" }}
                </div>
                <div class="col-md-12">
                    <label class="form-label small fw-bold text-secondary text-uppercase">Fournisseur Principal</label>
                    {{ form.fournisseur|add_class:"form-select bg-body-tertiary border-0" }}
                </div>
            </div>
        </div>
        <!-- SECTION 3: TECH / NOTES -->
        <div class="mb-4">
            <h6 class="text-uppercase text-muted fw-bold small mb-3 border-bottom pb-2">
                <i class="bi bi-clipboard-data me-2"></i>Informations Complémentaires
            </h6>
            <div class="row g-3">
                <div class="col-12">
                    <label class="form-label small fw-bold text-secondary text-uppercase">Notes Internes</label>
                    <!-- Check if 'notes' field exists, otherwise generic textarea -->
                    <textarea name="notes" class="form-control bg-body-tertiary border-0" rows="3"
                        placeholder="Informations techniques, contraintes logistiques..."></textarea>
                </div>
            </div>
        </div>
    </div>
    <!-- STICKY FOOTER ACTIONS -->
    <div class="p-3 bg-body-tertiary border-top sticky-bottom d-flex align-items-center shadow-lg z-3">
        <!-- Delete Button (Left) -->
        {% if form.instance.pk %}
        <button type="button" class="btn btn-outline-danger px-3 me-auto"
            onclick="if(confirm('Supprimer cet article ?')) alert('Action désactivée pour la démo')">
            <i class="bi bi-trash3-fill me-2"></i>Supprimer
        </button>
        {% endif %}
        <!-- Save/Cancel Buttons (Right) -->
        <div class="d-flex gap-2 ms-auto">
            <button type="submit" class="btn btn-primary px-5 fw-bold shadow-sm">Enregistrer</button>
        </div>
    </div>
</form>